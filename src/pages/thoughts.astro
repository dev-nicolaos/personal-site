---
import CTALink from "@components/CTALink.astro";
import Link from "@components/Link.astro";
import LocalizedDate from "@components/LocalizedDate.astro";
import PageHeader from "@components/PageHeader.astro";
import RSSAutodiscovery from "@components/RSSAutodiscovery.astro";
import RSSIcon from "@components/RSSIcon.astro";
import SiteHeader from "@components/SiteHeader.astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import { RSS_URL } from "../consts";
import { filterOutDrafts, sortThoughtsByPublishDate } from "../utils";

const thoughts = (await Astro.glob("./thoughts/**/*.md"))
  .filter(filterOutDrafts)
  .sort(sortThoughtsByPublishDate);
---

<style>
  .cta {
    gap: var(--space-xs);
    display: inline-flex;
    align-items: center;
    margin-block-end: var(--space-m-l);
  }

  li {
    align-items: flex-start;
    display: flex;
    flex-direction: column;
    gap: var(--space-s);
  }
  li:not(:last-of-type) {
    margin-block-end: var(--space-m-l);
  }

  li :global(a) {
    font-size: var(--font-size-secondary-heading);
  }

  li :global(time) {
    font-style: italic;
    font-size: var(--font-size-base);
  }
</style>

<BaseLayout title="Thoughts">
  <RSSAutodiscovery slot="head" />
  <SiteHeader />
  <main>
    <PageHeader heading="Thoughts" />

    <CTALink href={RSS_URL}>
      <span>Subscribe via RSS</span>
      <RSSIcon aria-hidden />
    </CTALink>

    <ul>
      {
        thoughts.map(({ frontmatter, url }) => (
          <li>
            <Link hoverEffect href={url + "/"}>
              {frontmatter.heading}
            </Link>
            <LocalizedDate date={frontmatter.publishDate} />
          </li>
        ))
      }
    </ul>
  </main>
</BaseLayout>
