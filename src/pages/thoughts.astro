---
import CTALink from "@components/CTALink.astro";
import Link from "@components/Link.astro";
import LocalizedDate from "@components/LocalizedDate.astro";
import PageHeader from "@components/PageHeader.astro";
import RSSAutodiscovery from "@components/RSSAutodiscovery.astro";
import RSSIcon from "@components/RSSIcon.astro";
import SiteHeader from "@components/SiteHeader.astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import { RSS_URL } from "../consts";
import { filterOutDrafts, sortThoughtsByPublishDate } from "../utils";

const thoughts = (await Astro.glob("./thoughts/**/*.md"))
  .filter(filterOutDrafts)
  .sort(sortThoughtsByPublishDate);
---

<style>
  .cta {
    gap: var(--space-xs);
    display: inline-flex;
    align-items: center;
    margin-block-end: var(--space-m-l);
  }

  .thought-listing {
    align-items: flex-start;
    display: flex;
    flex-direction: column;
    gap: var(--space-s);
  }
  .thought-listing:not(:last-child) {
    margin-block-end: var(--space-m-l);
  }

  .thought-link {
    font-size: var(--font-size-secondary-heading);
    font-weight: bold;
  }

  .thought-desc {
    font-size: var(--font-size-prose);
  }

  li :global(time) {
    font-size: var(--font-size-base);
    font-style: italic;
  }
</style>

<BaseLayout title="Thoughts">
  <RSSAutodiscovery slot="head" />
  <SiteHeader />
  <main>
    <PageHeader title="Thoughts" />

    <CTALink href={RSS_URL}>
      <span>Subscribe via RSS</span>
      <RSSIcon aria-hidden />
    </CTALink>

    <ul>
      {
        thoughts.map(({ frontmatter, url }) => (
          <li class="thought-listing">
            <Link class="thought-link" hoverEffect href={url + "/"}>
              {frontmatter.title}
            </Link>
            <p class="thought-desc">{frontmatter.description}</p>
            <LocalizedDate date={frontmatter.publishDate} />
          </li>
        ))
      }
    </ul>
  </main>
</BaseLayout>
